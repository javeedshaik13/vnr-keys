name: Test CI/CD Setup

on:
  workflow_dispatch: # Manual trigger only
  push:
    paths:
      - '.github/workflows/test-setup.yml'

jobs:
  test-setup:
    name: Test Setup
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        npm-version: '9'
        
    - name: Verify repository structure
      run: |
        echo "Checking repository structure..."
        [ -f "render.yaml" ] && echo "âœ… render.yaml found" || echo "âŒ render.yaml missing"
        [ -d "frontend" ] && echo "âœ… frontend directory found" || echo "âŒ frontend directory missing"
        [ -d "backend" ] && echo "âœ… backend directory found" || echo "âŒ backend directory missing"
        [ -f "frontend/package.json" ] && echo "âœ… frontend package.json found" || echo "âŒ frontend package.json missing"
        [ -f "backend/package.json" ] && echo "âœ… backend package.json found" || echo "âŒ backend package.json missing"
        
    - name: Test frontend build
      working-directory: ./frontend
      run: |
        echo "Installing frontend dependencies..."
        npm ci
        echo "Running frontend lint..."
        npm run lint
        echo "Building frontend..."
        npm run build
        echo "âœ… Frontend build successful"
        
    - name: Test backend setup
      working-directory: ./backend
      run: |
        echo "Installing backend dependencies..."
        npm ci
        echo "Checking backend syntax..."
        node -c index.js
        echo "âœ… Backend setup successful"
        
    - name: Check secrets configuration
      run: |
        echo "Checking if required secrets are configured..."
        echo "Note: This is a test run. In production, these would be actual secrets."
        echo "âœ… Test setup completed successfully"
        
    - name: Success message
      run: |
        echo "ğŸ‰ CI/CD setup test completed successfully!"
        echo ""
        echo "Next steps:"
        echo "1. Configure GitHub secrets (see CI_CD_SETUP.md)"
        echo "2. Enable branch protection"
        echo "3. Test with a real deployment"
